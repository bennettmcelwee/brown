<html>
<head>
<script src='jquery-1.4.4.min.js'></script>
</head>
<body>
<h2>Configured Sites</h2>
<div id='new-entry'>
URL: <input id='new-url' size='40'/><br/>
Frequency: <input id='new-frequency' size='5'/><br/>
<input type='submit' value='Add' id='add-button' onClick='javascript:addRow();'/>
</div>
<hr/>
<div id='container'>
</div>
<script>

function getSites()
{
    return JSON.parse(localStorage['nexty.data']);
}

function storeSites(sites)
{
    localStorage['nexty.data'] = JSON.stringify(sites);
}

function deleteRow(i)
{
    var sites = getSites();
    sites = sites.slice(0, i).concat(sites.slice(i + 1, sites.length));
    storeSites(sites);
    display();
}

function addRow()
{
    var url = $('#new-url').val();
    var frequency = $('#new-frequency').val();
    var site = {url: url, nextTime: 0, frequency: frequency};
    var sites = getSites();
    sites = [site].concat(sites);
    storeSites(sites);
    display();
}

function display()
{
    var sites = getSites();
    var s = '<table><tr><td>Freq</td><td>Next</td><td>Del</td><td>Site</td></tr>';
    var now = new Date().getTime();
    for (var i = 0; i < sites.length; i++)
    {
        var site = sites[i];
        s += '<tr><td>';
        s += site.frequency + '</td><td>';
        var delay = site.nextTime - now; 
        if (delay <= 0) {
            s += 'Due';
        } else {
            s += Math.ceil(delay / 60 / 60 / 1000) + ' hours';
        }
        s += '</td><td>';
        s += '<img src="delete.png" onClick="javascript:deleteRow(' + i + ');"/></td><td>';
        s += site.url + '</td></tr>';
    }
    s += '</table>';
    $('#container').html(s);
}

display();

</script>
</body>
</html>
